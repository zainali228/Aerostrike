#!/usr/bin/env python3
"""
Controller module for WiFi Penetration Testing Tool
Manages communication between GUI and core functionality
"""

import os
import json
import time
import threading
import subprocess
from typing import Dict, List, Any, Callable, Optional

# Avoid circular import - we'll access these through the parent_controller


class AIController:
    """Controller for AI-assisted functionality"""
    
    def __init__(self, parent_controller=None):
        """Initialize the AI controller
        
        Args:
            parent_controller: Reference to the main application controller
        """
        self.parent_controller = parent_controller
        self.vulnerabilities = []
        self.hosts = []
        
    def get_vulnerabilities(self) -> List[Dict]:
        """Get list of discovered vulnerabilities
        
        Returns:
            List[Dict]: List of vulnerability dictionaries
        """
        # Return cached vulnerabilities or get from parent controller
        if self.vulnerabilities:
            return self.vulnerabilities
            
        if self.parent_controller and hasattr(self.parent_controller, 'post_exploitation'):
            # Get vulnerabilities from post-exploitation module
            vuln_data = self.parent_controller.post_exploitation.get_vulnerabilities()
            if vuln_data:
                self.vulnerabilities = vuln_data
                return vuln_data
                
        # If no real data available, return empty list
        return []
        
    def get_network_hosts(self) -> List[Dict]:
        """Get list of discovered network hosts
        
        Returns:
            List[Dict]: List of host dictionaries
        """
        # Return cached hosts or get from parent controller
        if self.hosts:
            return self.hosts
            
        if self.parent_controller and hasattr(self.parent_controller, 'post_exploitation'):
            # Get hosts from post-exploitation module
            host_data = self.parent_controller.post_exploitation.get_hosts()
            if host_data:
                self.hosts = host_data
                return host_data
                
        # If no real data available, return empty list
        return []
        
    def set_openai_api_key(self, api_key: str) -> bool:
        """Set OpenAI API key for AI functions
        
        Args:
            api_key: OpenAI API key
            
        Returns:
            bool: True if API key was set successfully
        """
        # Store in environment variable
        os.environ["OPENAI_API_KEY"] = api_key
        return True